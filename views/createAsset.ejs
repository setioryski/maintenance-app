<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Buat Asset Baru</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100">
  <div class="max-w-2xl mx-auto mt-8 p-4 bg-white shadow-md rounded">
    <h1 class="text-xl font-bold mb-6">Buat Asset Baru</h1>
    <form action="/assets" method="POST">
      <!-- Asset Name -->
      <div class="mb-4">
        <label for="name" class="block text-gray-700 font-semibold mb-1">Nama Asset</label>
        <input
          type="text"
          name="name"
          id="name"
          class="w-full border border-gray-300 rounded p-2"
          required
        >
      </div>
      
      <!-- Description -->
      <div class="mb-4">
        <label for="description" class="block text-gray-700 font-semibold mb-1">Deskripsi</label>
        <textarea
          name="description"
          id="description"
          class="w-full border border-gray-300 rounded p-2"
        ></textarea>
      </div>
      
      <!-- Location -->
      <div class="mb-4">
        <label for="location" class="block text-gray-700 font-semibold mb-1">Lokasi</label>
        <input
          type="text"
          name="location"
          id="location"
          class="w-full border border-gray-300 rounded p-2"
        >
      </div>
      
      <!-- Category -->
      <div class="mb-4">
        <label for="category" class="block text-gray-700 font-semibold mb-1">Kategori Asset</label>
        <select
          name="category"
          id="category"
          class="w-full border border-gray-300 rounded p-2"
          required
        >
          <option value="" disabled selected>-- Pilih Kategori --</option>
          <% assetCategories.forEach(function(category) { %>
            <option value="<%= category._id %>"><%= category.name %></option>
          <% }); %>
        </select>
      </div>
      
      <!-- Floor -->
      <div class="mb-4">
        <label for="floor" class="block text-gray-700 font-semibold mb-1">Lantai</label>
        <select
          name="floor"
          id="floor"
          class="w-full border border-gray-300 rounded p-2"
          required
        >
          <option value="">-- Pilih Lantai --</option>
          <% floors.forEach(function(floor) { %>
            <option value="<%= floor._id %>"><%= floor.name %></option>
          <% }); %>
        </select>
      </div>
      
      <!-- Zone (Populated Dynamically) -->
      <div class="mb-4">
        <label for="zone" class="block text-gray-700 font-semibold mb-1">Zona</label>
        <select
          name="zone"
          id="zone"
          class="w-full border border-gray-300 rounded p-2"
          required
        >
          <option value="">-- Pilih Zona --</option>
        </select>
      </div>
      
      <!-- Submit Button -->
      <div class="flex justify-end">
        <button
          type="submit"
          class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded"
        >
          Simpan Asset
        </button>
      </div>
    </form>
  </div>
  
  <script>
    // Inject zones as a JSON string and then parse it.
    var zonesData = '<%- JSON.stringify(zones || []) %>';
    const zones = JSON.parse(zonesData);

    const floorDropdown = document.getElementById('floor');
    const zoneDropdown = document.getElementById('zone');

    // When the floor selection changes, update the zone dropdown.
    floorDropdown.addEventListener('change', function() {
      const selectedFloorId = this.value;
      // Clear current options in zone dropdown
      zoneDropdown.innerHTML = '<option value="">-- Pilih Zona --</option>';
      
      // Filter zones that belong to the selected floor.
      zones.forEach(function(zone) {
        // Compare zone.floor with selectedFloorId
        if(zone.floor.toString() === selectedFloorId) {
          const option = document.createElement('option');
          option.value = zone._id;
          option.textContent = zone.name;
          zoneDropdown.appendChild(option);
        }
      });
    });
  </script>
</body>
</html>
